#N canvas 212 41 687 818 12;
#X text 95 10 signal;
#X obj 195 9 inlet~;
#X text 246 9 control signal;
#X obj 12 11 inlet~ fwd;
#N canvas 92 117 450 300 messages 0;
#X obj 36 22 inlet;
#X obj 36 70 s \$0-att;
#X obj 83 95 s \$0-rel;
#X obj 125 72 s \$0-thresh;
#X obj 36 46 route att rel thresh gain;
#X obj 168 107 s \$0-gain;
#X connect 0 0 4 0;
#X connect 4 0 1 0;
#X connect 4 1 2 0;
#X connect 4 2 3 0;
#X connect 4 3 5 0;
#X restore 79 42 pd messages;
#X text 294 56 window is 512 samples \, check every 256;
#X obj 195 85 / 100;
#X text 238 88 normalize rms to 0-1 float;
#X obj 195 117 clip 0 1;
#X text 263 116 Keep in bounds 0 - 1;
#X obj 195 261 sqrt;
#X text 240 261 sqrt to match the power 2 curve;
#N canvas 121 146 450 486 pass-values-over-thresh 0;
#X obj 37 17 inlet;
#X text 114 74 if greater than or equal to the thresh set;
#X obj 37 73 moses 0.35;
#X obj 104 372 outlet, f 14;
#X obj 196 154 swap 1;
#X obj 196 178 -;
#X obj 164 100 r \$0-thresh;
#X obj 164 124 t a a;
#X text 168 207 normalize;
#X obj 104 206 + 0.35;
#X obj 104 175 * 0.65;
#X obj 152 252 r \$0-gain;
#X obj 104 301 * 1;
#X obj 105 32 r \$0-thresh;
#X text 157 302 adjust gain \, how much it dips;
#X connect 0 0 2 0;
#X connect 2 1 10 0;
#X connect 4 0 5 0;
#X connect 4 1 5 1;
#X connect 5 0 10 1;
#X connect 6 0 7 0;
#X connect 7 0 9 1;
#X connect 7 1 4 0;
#X connect 9 0 12 0;
#X connect 10 0 9 0;
#X connect 11 0 12 1;
#X connect 12 0 3 0;
#X connect 13 0 2 1;
#X restore 195 203 pd pass-values-over-thresh;
#X obj 195 431 vline~;
#X obj 195 455 pow~ 2;
#X obj 12 665 *~;
#X obj 12 719 outlet~;
#X obj 234 304 r \$0-att;
#X obj 275 332 r \$0-rel;
#X text 300 365 pack the target signal and the attack+release;
#X obj 194 365 pack 0 10 20;
#X obj 195 53 env~ 512 256;
#X obj 45 555 sig~ 1;
#X obj 46 607 -~, f 22;
#X msg 195 401 \$1 \$2 \, 0 \$3 \$2;
#X obj 46 639 clip~ 0 1;
#X text 252 454 pow 2 curve;
#X text 120 638 make sure amplitude stays within 0-1;
#X text 61 581 inverse signal;
#X connect 1 0 21 0;
#X connect 3 0 15 0;
#X connect 3 1 4 0;
#X connect 6 0 8 0;
#X connect 8 0 12 0;
#X connect 10 0 20 0;
#X connect 12 0 10 0;
#X connect 13 0 14 0;
#X connect 14 0 23 1;
#X connect 15 0 16 0;
#X connect 17 0 20 1;
#X connect 18 0 20 2;
#X connect 20 0 24 0;
#X connect 21 0 6 0;
#X connect 22 0 23 0;
#X connect 23 0 25 0;
#X connect 24 0 13 0;
#X connect 25 0 15 1;
